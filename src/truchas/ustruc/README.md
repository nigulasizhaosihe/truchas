# Microstructural Analysis

This directory contains source code that implements a framework for
the analysis of solidification as it evolves on each cell. It targets
0-dimensional analytic models that use local information like the thermal
gradient, solidification front velocity, cooling rate, and time spent in
the mushy zone to predict the local microstructural characteristics and
defects of the solidified material. The framework is designed to easily
accomodate additional user-written analysis models.

The initial implementation of the framework was funded by LDRD 20140639ER
"Solute and Microstructure Prediction during Processing", with subsequent
improvements funded by a DOE HPC4Mfg project in collaboration with GE Global
Research under CRADA LA19C10783.

## Overview
This is an overview of the framework with links to further pages providing
more detail

* The `ustruc_analysis` class and its several extensions implement the core
  framework which applies the 0-dimensional analysis at each "point" of an array
  of independent points. They are described in detail by the
  [ustruc_analysis.md](./doc/ustruc_analysis.md) page.

* The `ustruc_analysis_factory` module provides a procedure for instantiating
  `ustruc_analysis` class objects, using inputs supplied by a parameter list.
  The procedure and format of the parameter list input are described in detail
  by the [ustruc_analysis_factory.md](./doc/ustruc_analysis_factory.md) page.

* The `ustruc_model` derived type implements the interface between Truchas mesh
  and material data structures and the core `ustruc_analysis` framework.
  It is described in detail by the [ustruc_model.md](./doc/ustruc_model.md) page.

* The [`ustruc_driver`](./ustruc_driver.F90) module hosts a single instance
  of the `ustruc_model` type, and provides procedures that operate on that
  singleton. The module should be regarded as being part of the top-level
  Truchas driver, which has an old-fashioned, non-OO implementation that eschews
  passing data through procedure arguments in favor of using module variables
  through `use` association. The module provides the following procedures:
  * `read_microstructure_namelist`: If present, reads the `MICROSTRUCTURE`
    namelist from the Truchas input file, and translates it to a parameter list
    for later use. This also "enables" the microstructure analysis framework.
  * `ustruc_enabled`: Returns true if the microstructure framework is enabled.
  * `ustruc_driver_init`: This initializes the `ustruc_model` singleton using
    the parameter list generated by `read_microstructure_namelist`.
  * `ustruc_driver_final`: A "finalizer" for the driver.
  * `ustruc_update`: Updates the microstructure analysis. Called after every
    time step.
  * `ustruc_output`: Outputs the microstructure analysis data and internal
    state (for restarts). Called as part of the usual Truchas HDF time step
    output process.
  * `ustruc_read_checkpoint`: Restores the internal state of the microstructure
    analysis framework reading the data from the restart file.
  * `ustruc_skip_checkpoint`: Skips over the microstructure restart data in
    the event the microstructure framework is not enabled.
